## 京脉

### 简介

1. 群脉[微信全域流量]和京东[大数据部门]合作的通过 KOL[流量主] 根据相关人群画像帮助商店针对性的推广和引流, 并统计推广结果的项目

### 周期

1. date: 2020-05-12 - 2021-01-31

### 语言

1. backend

   - java

2. frontend
   - vue2
   - antd

### 职责

1. 根据原型图设计理解需求并设计 Rest API
2. 设计数据库表和优化
3. 相关功能的实现: **admin/Agency**/kol
4. 研究 oauth, nginx 的流程: 社交登陆
5. 推荐模型的实现与迭代:
6. 埋点: sku, campaign,
7. 开发平台的相关集成
8. ES 和 grpc 的简单使用
9. oss

---

### 详情

#### 相关概念的关系

1. MCN 机构 - KOL 管理员: 1 - n
2. KOL 管理员 - KOL: 1 - n
3. 品牌 - 店铺: 1 - n
4. 店铺 - SKU: 1 - n

#### KOL H5 端[公众号]: KOL 的入驻及相关任务的展示

1. KOL 入驻流程

   - 打标签
   - 落地页的设计
   - 授权 `群脉` + `京东` 的流程
     - `群脉`: 权限集的问题, 获取基本数据信息
     - `京东`: 粉丝人群画像, 链路数据追踪
   - 使用 MCN Code 入住[敏捷开发]: 针对 KOL 入驻的一种补偿机制[人员/手机号问题]

2. KOL 粉丝人群画像

   - 数据来自 `京东`: **类目偏好, 性别, 婚姻, 年龄, 职业, 学历, 消费力推荐, 城市**

3. 推广任务列表

   - 模板消息
   - 列表查看: 带有埋点规则的链接[可接受、拒绝、忽略推送给自己的任务]
   - 查看详情: 这里会带上卖点的相关信息[kol 会将该埋点信息放入公证号推文中, 粉丝用户浏览的时候 jd 会统计链路数据]
   - KOL 推文并附上链接: 为了后面的链路数据
     ```js
     const shopId = this.item.task.promotionTarget.value;
     const utmCampaign = `${packageId}_${shopId}_`;
     `${skuRoute}?sku=${skuId}&EA_PTAG=${EA_PTAG}&utm_source=${utmSource}&utm_medium=${utmMedium}&utm_campaign=${utmCampaign}`;
     `${shopRoute}?shopId=${shopId}&EA_PTAG=${EA_PTAG}&utm_source=${utmSource}&utm_medium=${utmMedium}&utm_campaign=${utmCampaign}`;
     utmCampaign = `${packageId}_${shopIds.join('*')}_${skuIds.join('*')}`;
     `${activityRoute}?encode_url=${encodeUrl}&EA_PTAG=${EA_PTAG}&utm_source=${utmSource}&utm_medium=${utmMedium}&utm_campaign=${utmCampaign}`;
     ```

4. 个人中心

   - 切换公众号

5. 如果是 MCN 机构号, 则只需要验证邀请码

#### Agency PC 端: 基于品牌的人群画像 + kol 粉丝的人群画像 + agency 的选择条件推荐合适的 kol

1. [登录](https://docs.jdcloud.com/cn/ias/oauth2-service)

   - 使用 `京东` 的联合登录接口: **只是使用了对方的 UI 及扫码功能, 及用户标识; 自己维护了 token 的生命周期**
   - 做法: 使用对方的 UI 扫码授权[oauth done]之后后可以拿到用户标识, 创建自己的 token, 并维护其生命周期

2. 管理 sku

   - 需通过京东校验 sku 归属
   - sku 需提交到京东, 京东后台任务做人群画像分析

3. 查看 sku 购买人群画像[品牌洞察]
   - 商品的管理[计算人群画像和链路数据很消耗资源的]: **京东的开放平台**
4. 查看推广任务清单
5. 查看推广任务详情: 可按 _任务_ 或 _KOL_ 查看推广效果
   - 浏览、加购、下单、支付等统计数据
   - 数据按天增量获取, 入库, 聚合, 展示
6. 发布新推广任务[OSS]: 品牌方会根据自己商品的人群画像与 KOL 的人群画像及 KOL 报价等相关信息, 选择 KOL 对自己的产品进行推广

   - 推广类型: SKU, 店铺, 活动
   - 任务的全生命周期的管理
   - [筛选 KOL[_京东大数据_]](https://mubu.com/doc/A5nO1Q-Vyk): **`维度 + 筛选`**

     - 维度: 该 SKU 的人群画像与所有 KOL 的人群画像各自 TOP5
     - KOL 综合排序指标推荐算法: 根据定义算出有效维度[推荐筛选指标], 计算对应的人群画像的匹配度
     - 人群匹配值算法模型: `sum(筛选指标项占比总和*总指标项数*权值/筛选指标项数)/sum(总指标项数/筛选指标项数)`
     - ~~有一次关于人群画像圈死的调整: 完全根据 SKU 做计算, 人群被画死了~~

7. 切换品牌

#### Admin PC 端

1. 登录: SSO
2. 品牌管理: **京东的开放平台**
   - 创建 Agency 的用户
   - 生命流程的管控
3. KOL 管理: **需要与 KOL 管理员和 MCN 耦合**

   - 生命流程的管控
   - 审核导出等基本功能

4. MCN 的管理

   - 生命流程的管控
   - 特出场景的处理: KOL, KOL 管理员和 MCN 是一个人的情况
   - 处理 KOL, KOL 管理员和 MCN 绑定与换绑的问题

#### demo data 的整理

1. 这个是一项必要的工作

---

## 相关数据

### 群脉

1. 粉丝相关

   - 累计关注人数：每日更新，从微信统计数据中获取
   - 每月新增关注人数：最近 6 个月平均每月新增关注数量，从微信统计数据中获取
   - 每月取消关注人数：最近 6 个月平均每月新增关注数量，从微信统计数据中获取

2. 图文相关：最近 6 个月的统计，每日更新一次，从微信统计数据中获取

   - 文章数
   - 送达人次
   - 阅读人次
   - 原文阅读人次
   - 分享人次
   - 收藏人次

3. 行为相关： 最近 6 个月的数据，分类统计 + 汇总统计，每日更新一次

4. 公众号消息： 分类统计 + 汇总统计

   - 文字
   - 图片
   - 语音
   - 视频
   - 小视频
   - 地理位置
   - 链接
   - 文章留言
   - 点菜单
   - 关注
   - 扫码

### 京东

1. 数据维度: 计算 sku 的值根据我们的输入数据

   - 年龄
   - 婚姻
   - 性别
   - 学历
   - 消费力推荐
   - 城市
   - TOP5 品牌偏好: 该 SKU 的人群画像与所有 KOL 的人群画像各自 TOP5
   - 经常浏览的类目偏好
   - 经常购买的类目偏好

## 个人总结

1. 埋点规则的理解: 理解链路数据的统计即埋点规则的设计
2. 由于是基于 `群脉和京东` 做的产品导致的授权时域名跳转的复杂性
   - ui --> code --> 拼接 wechat oauth url --> wechat[ui] --> `群脉`[auth-done] --> code --> front
3. 第三方平台对接的不确定性的疼苦, 提高了自身的沟通和对接能力
   - 由于需要同步的通知京东做数据 track 的交互是心碎的
4. 项目的业务具有一定的复杂性, 尤其是需要跟着用户的想法做事情
5. **体验了一把什么叫敏捷开发!!!**
6. 数据库表结构的频繁改动的 migration 简直就是 _灾难_
7. 缺少相关的 QA 的 case by case 的测试
8. 通过对接口的设计更加深入放入理解了 Rest API 的设计
9. 了解相关人群画像的使用和评分的算法模型的设计和迭代
